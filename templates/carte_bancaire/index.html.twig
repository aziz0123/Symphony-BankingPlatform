{% extends 'baseback.html.twig' %}

{% block texte %}

	<!-- Quick Action Toolbar Starts-->

	<!-- Quick Action Toolbar Ends-->

	<!-- content-wrapper ends -->
	<!-- partial:partials/_footer.html -->

		<div class="row" style="display:  center;margin-top: 10px;"> <a href="{{ path ('addCarte')}}">
			<i class="ri-arrow-left-circle-fill" style="font-size: 60px;"></i>
		</a>
	
	
		<table class="table">
			<h5 class="card-title">Listes Des Cartes Bancaires</h5>
			<input type="text" id="searchInput" placeholder="Search...">

			<table id="table" class="table table-striped">
				<thead>
					<tr>
						<th scope="col">nom</th>
						<th scope="col">numCarte</th>
						<th scope="col">cvv</th>
						<th scope="col">email</th>
						<th scope="col">date de creation</th>
						<th scope="col">date d'expiration</th>

						<th scope="col">idType</th>
						<th scope="col">Etat</th>

						<th scope="col">action</th>
					</tr>
				</thead>
				<tbody>
					{% for CarteBancaire in b %}
						<tr>
							<td>
								{{ CarteBancaire.nom }}</td>

							<td>{{  CarteBancaire.numCarte }}</td>
							<td>{{  CarteBancaire.cvv}}
							</td>
							<td>{{  CarteBancaire.email }}</td>
							<td>{{  CarteBancaire.date |date('d-m-Y') }}</td>
							<td>{{  CarteBancaire.DateExp |date('d-m-Y') }}</td>
							


							<td>
								{{ CarteBancaire.idType }}</td>
								<td>{{  CarteBancaire.etat }}</td>
							<td>
              
								<a class="btn btn-success" href="{{path('modifierCarteBancaire',{'id':CarteBancaire.id}) }}">modifier
								</a>
								<a class="btn btn-danger" href="{{path('deleteCarteBancaire',{'id':CarteBancaire.id}) }}">supprimer
								</a>
                 


								{#{% if CarteBancaire.id =="banned" %}
																               {% set e ="unban" %}
																               {% else %}
																              {% set e ="ban" %}
																                {% endif %}
																              <a href="{{path('bann',{'nom':CarteBancaire.id}) }}">{{  e }} </a>#}

							</td>
               {% if CarteBancaire.etat == "blocage" %}
                    <td><a class="btn btn-success" href="{{ path('setEtat',{'id':CarteBancaire.id}) }}">activer</a></td>
                {% else %}
                                        <td><a class="btn btn-success" href="{{ path('setEtat',{'id':CarteBancaire.id}) }}">bloquer</a></td>

                {% endif %}
						</tr>

					{% endfor %}

				</tbody>
			</table>
		</table>
		<button id="exportBtn">Export to CSV</button>
 <script>
    function downloadCSV(csv, filename) {
        const csvFile = new Blob([csv], { type: 'text/csv' });
        const downloadLink = document.createElement('a');
        downloadLink.download = filename;
        downloadLink.href = window.URL.createObjectURL(csvFile);
        downloadLink.style.display = 'none';
        document.body.appendChild(downloadLink);
        downloadLink.click();
    }

    function filterTable() {
        const filter = document.getElementById('searchInput').value.toUpperCase();
        const rows = document.querySelectorAll('table tr');
        for (let i = 1; i < rows.length; i++) {
            const cols = rows[i].querySelectorAll('td');
            let visible = false;
            for (let j = 0; j < cols.length; j++) {
                const cell = cols[j];
                if (cell.innerText.toUpperCase().indexOf(filter) > -1) {
                    visible = true;
                    break;
                }
            }
            rows[i].style.display = visible ? '' : 'none';
        }
    }

    function exportTableToCSV(filename) {
        const csv = [];
        const rows = document.querySelectorAll('table tr');
        for (let i = 1; i < rows.length; i++) {
            if (rows[i].style.display !== 'none') {
                const row = [], cols = rows[i].querySelectorAll('td, th');
                for (let j = 0; j < (cols.length)-1; j++)
                    row.push(cols[j].innerText);
                csv.push(row.join(','));
            }
        }
        downloadCSV(csv.join('\n'), filename);
    }

    document.getElementById('searchInput').addEventListener('keyup', filterTable);
    document.getElementById('exportBtn').addEventListener('click', function() {
        exportTableToCSV('Bonachat.csv');
    });
  </script>
		<nav aria-label="Example Pagination ">
			<ul class="pagination pg-blue">
				<li class="page-item">
					<a class="page-link" aria-label="Previous">
						<span aria-hidden="true">&laquo;</span>
						<span class="sr-only">Previous</span>
					</a>
				</li>
				<li class="page-item">
					<a href="/displaycarte?page=1" class="page-link active-pagination1">1</a>
				</li>
				<li class="page-item">
					<a href="/displaycarte?page=2" class="page-link">2</a>
				</li>
				<li class="page-item">
					<a href="/displaycarte?page=3" class="page-link">3</a>
				</li>
				<li class="page-item">
					<a href="/displaycarte?page=4" class="page-link">4</a>
				</li>
				<li class="page-item">
					<a class="page-link" aria-label="Next">
						<span aria-hidden="true">&raquo;</span>
						<span class="sr-only">Next</span>
					</a>
				</li>
			</ul>
		</nav>
	</div>
  <script src="{{ asset("js/carte.js") }}"></script>
{% endblock %}
